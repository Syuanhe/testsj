<?xml version="1.0" encoding="utf-8"?>
<ms2>

  <state name="대기">
    <onEnter>
      <action name="EnableSpawnPointPC" spawnPointID="1" isEnable="0" />    <!-- <시작 위치 세팅> -->
      <action name="EnableSpawnPointPC" spawnPointID="2" isEnable="0" />
      <action name="EnableSpawnPointPC" spawnPointID="3" isEnable="0" />
      <action name="EnableSpawnPointPC" spawnPointID="4" isEnable="0" />
      <action name="타이머를초기화한다" arg1="1" />
      <action name="타이머를초기화한다" arg1="2" />
      <action name="타이머를초기화한다" arg1="3" />
      <action name="이펙트를설정한다" arg1="2001-2016" arg2="1" />
      <action name="메쉬를설정한다" arg1="1001-1048" arg2="1" />    <!-- <가두기 트리거 메쉬> -->
      <action name="액터를설정한다" arg1="1901" arg2="1" arg3="Idle_A" />   <!-- <연출용 액터> -->
      <action name="ShadowExpedition" type="CloseBossGauge" />
      <action name="SetUserValue" triggerID="99990002" key="SpawnStart" value="0" />
      <action name="SetUserValue" triggerID="99990003" key="ObjectPhase" value="0" />
      <action name="SetUserValue" triggerID="99990008" key="BossPhase" value="0" />
    </onEnter>
    <condition name="유저를감지했으면" arg1="9001">
      <transition state="유저카운트"/> 
    </condition>
  </state>

  <state name="유저카운트">
    <onEnter>
      <action name="타이머를설정한다" arg1="99" arg2="10" arg="4" arg5="60" />
      <action name="이벤트UI를설정한다" arg1="1" arg2="입장을 기다리는 중입니다.\n10초 후에 게임이 시작됩니다.\n10명이 모이면 바로 시작됩니다." arg3="5000" />
    </onEnter>
    <condition name="CountUsers" arg1="9002" arg2="10" arg3="=" > <!-- 입장 인원이 10명 이면 바로 게임 시작 -->
      <transition state="딜레이" />
    </condition>
    <condition name="시간이경과했으면" arg1="99" >  <!-- 10초가 지나면 게임 시작 -->
      <transition state="딜레이" />
    </condition>
  </state>

  <state name="딜레이">
    <onEnter>
      <action name="이벤트UI를설정한다" arg1="1" arg2="검은 군단을 소환하는 오브젝트를 파괴해야 합니다.\n일반적인 공격으로는 피해를 입지 않습니다." arg3="5000" />
      <action name="카메라를선택한다" arg1="999" arg2="1" />
    </onEnter>
    <condition name="WaitTick" waitTick="5000">
      <transition state="시작" />
    </condition>
  </state>

  <state name="시작">   <!-- <시작> -->
    <onEnter>
      <action name="몬스터를생성한다" arg1="701" arg2="0"/>   <!-- <무적 오브젝트 생성> -->
      <action name="EnableSpawnPointPC" spawnPointID="1" isEnable="1" />
      <action name="EnableSpawnPointPC" spawnPointID="2" isEnable="1" />
      <action name="EnableSpawnPointPC" spawnPointID="3" isEnable="1" />
      <action name="EnableSpawnPointPC" spawnPointID="4" isEnable="1" />
      <action name="카메라리셋" interpolationTime="1" />
      <action name="이펙트를설정한다" arg1="2001-2016" arg2="0" />
      <action name="메쉬를설정한다" arg1="1001-1048" arg2="0" />
      <action name="이벤트UI를설정한다" arg1="0" arg2="1,3" />
      <action name="이벤트UI를설정한다" arg1="1" arg2="적들을 처치하고 게이지를 채우세요." arg3="5000" />
      <action name="타이머를설정한다" arg1="1" arg2="180" arg3="1" arg4="1" arg5="60" />    <!-- <1라운드 게임 플레이 타임 설정> -->
      <action name="ShadowExpedition" type="OpenBossGauge" maxGaugePoint="800" />
      <action name="SetUserValue" triggerID="99990002" key="SpawnStart" value="1" />
      <action name="액터를설정한다" arg1="1901" arg2="0" arg3="Idle_A" />
    </onEnter>
    <condition name="UserValue" key="GaugeClear" value="1" >    <!-- <게이지를 다 채울 경우 다음 라운드> -->
      <transition state="오브젝트페이즈"/>
    </condition>
    <condition name="시간이경과했으면" arg1="1">    <!-- <시간 내에 클리어하지 못할 경우 실패> -->
      <transition state="실패_세팅"/>
    </condition>
  </state>

  <state name="오브젝트페이즈">
    <onEnter>
      <action name="이벤트UI를설정한다" arg1="1" arg2="주변의 오브젝트를 찾아 파괴하고 웨폰 오브젝트를 얻으세요." arg3="5000" />
      <action name="ShadowExpedition" type="CloseBossGauge" />
      <action name="이벤트UI를설정한다" arg1="0" arg2="2,3" />
      <action name="타이머를초기화한다" arg1="1" />
      <action name="SetUserValue" triggerID="99990003" key="ObjectPhase" value="1" />
      <action name="타이머를설정한다" arg1="2" arg2="180" arg3="1" arg4="1" arg5="60" />    <!-- <2라운드 게임 플레이 타임 설정> -->
    </onEnter>
    <condition name="UserValue" key="ObjectClear" value="1" >    <!-- <오브젝트를 파괴했을 경우 다음 라운드> -->
      <transition state="보스페이즈"/>
    </condition>
    <condition name="시간이경과했으면" arg1="2">    <!-- <시간 내에 클리어하지 못할 경우 실패> -->
      <transition state="실패_세팅"/>
    </condition>
  </state>

  <state name="보스페이즈">
    <onEnter>
      <action name="몬스터소멸시킨다" arg1="all" />
      <action name="이벤트UI를설정한다" arg1="1" arg2="보스가 등장했습니다." arg3="3000" />
      <action name="타이머를초기화한다" arg1="2" />
      <action name="이벤트UI를설정한다" arg1="0" arg2="3,3" />
      <action name="SetUserValue" triggerID="99990008" key="BossPhase" value="1" />
      <action name="타이머를설정한다" arg1="3" arg2="180" arg3="1" arg4="1" arg5="60" />    <!-- <3라운드 게임 플레이 타임 설정> -->
    </onEnter>
    <condition name="UserValue" key="BossClear" value="1" >    <!-- <보스를 처치했을 경우 성공> -->
      <transition state="성공_세팅"/>
    </condition>
    <condition name="시간이경과했으면" arg1="3">    <!-- <시간 내에 클리어하지 못할 경우 실패> -->
      <transition state="실패_세팅"/>
    </condition>
  </state>

  <state name="성공_세팅">
    <onEnter>
      <action name="SideNpcTalk" type="talk" npcID="25100005" illust="Turka_normal" duration="5000" script="말도 안돼!!" />
      <action name="타이머를초기화한다" arg1="1" />
      <action name="타이머를초기화한다" arg1="2" />
      <action name="타이머를초기화한다" arg1="3" />
      <action name="SetUserValue" triggerID="99990002" key="SpawnStart" value="2" />
      <action name="SetUserValue" triggerID="99990003" key="ObjectPhase" value="2" />
      <action name="SetUserValue" triggerID="99990004" key="BossPhase" value="2" />
    </onEnter>
    <condition name="WaitTick" waitTick="5000">
        <transition state="성공" />
    </condition>
  </state>

  <state name="실패_세팅">
    <onEnter>
      <action name="SideNpcTalk" type="talk" npcID="25100005" illust="Turka_normal" duration="5000" script="내가 뭐라고 했나. 너희는 아직 멀었다!" />
      <action name="타이머를초기화한다" arg1="1" />
      <action name="타이머를초기화한다" arg1="2" />
      <action name="타이머를초기화한다" arg1="3" />
      <action name="SetUserValue" triggerID="99990002" key="SpawnStart" value="2" />
      <action name="SetUserValue" triggerID="99990003" key="ObjectPhase" value="2" />
      <action name="SetUserValue" triggerID="99990004" key="BossPhase" value="2" />
    </onEnter>
    <condition name="WaitTick" waitTick="5000">
        <transition state="실패" />
    </condition>
  </state>

  <state name="성공">
    <onEnter>
      <action name="몬스터소멸시킨다" arg1="all" />
      <action name="DungeonClear" />
    </onEnter>
    <condition name="무조건" >
      <transition state="종료"/>
    </condition>
  </state>

  <state name="실패">
    <onEnter>
      <action name="몬스터소멸시킨다" arg1="all" />
      <action name="DungeonFail" />
    </onEnter>
    <condition name="무조건" >
      <transition state="종료"/>
    </condition>
  </state>

  <state name="종료">
    <onEnter>
    </onEnter>
  </state>
  
</ms2>
